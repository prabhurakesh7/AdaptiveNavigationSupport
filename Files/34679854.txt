avoid blocking queue browsing activemq checkpoint call 
problem activemq large number persistence queues persistent textmessages kb scenario requires messages remain storage long time days consumed large amounts data staged distribution consumer offline days persistence store filled messages broker restart browse consume queues em em checkpoint call seconds call broker memory releases tasks queue browse consume internally messagecursor decide memory stops delivery queue content browsers consumers strong avoid behaviour configuration bug strong expectation consume browse queue circumstances settings production time recommendations applied found activemq documentation destination policies systemusage persistence store options ul li behaviour tested activemq li li memory settings xmx 1024m li li li li os windows macos linux li li persistenceadapter kahadb leveldb li li disc free space gb physical memory gb max li ul mentioned settings settings broker btw changing memorylimit lower 1mb change situation set strong cursormemoryhighwatermark strong destinationpolicy higher strong strong strong strong depending difference memoryusage heap space relieves situation bit workaround option production systems point view screenie information oracle mission control showing activemqtextmessage instances released memory href http goo gl ejeixv rel nofollow http goo gl ejeixv 

solution problem changing queue destination policyentry investigation changing activemq source code result accept limitations defined single memorylimit parameter checkpoint cleanup process browsing consuming queues strong memory strong problem higher memorylimit higher max heap support message caching destination checkpoint cleanup workflow requirements browse consume messages memory option scenario deal 1024m max heap 500m memorylimit constantly setting higher memorylimits persistent queues hundreds thousands pending messages offline inactive consumer scenarios discussed detail imho strong persistent adapters strong ruled persistent adapters problem behaviour doesnt change switch types persistent stores kahadb leveldb jdbc postgresql debugging sessions kahadb regular checkpoint handling storage managed expected strong destination policy expiration check strong problem completely disappears disable caching expiration check actual problem properties documented nice blog article message priorities description suitable scenario ul li href http activemq apache org support priority queues html rel nofollow http activemq apache org support priority queues html li li href http blog christianposta activemq activemq message priorities works rel nofollow http blog christianposta activemq activemq message priorities works li ul simply added usecache false expiremessagesperiod policyentry consequences clear dont mem caching anymore check message expiration message expiration message priorities current message dispatching fast trade acceptable system limitations defined prefetch limits memory consumption specific workflows message sizes scenario bytes approx kb individual policyentries client consumer configurations helpful optimize system behaviour performance memory usage href http activemq apache org destination policies html rel nofollow http activemq apache org destination policies html 