approximate number lines gb delimited file 
validate large delimited file checking number rows file matches approximately number appended trailer approaches dont accept bringing file heap processing start validation step complete tail parse trailer row count efficient planning 1mb rows sample file ideally random count rows multiply approximation rows file limit creating sample reading number rows checking size question sample reading file start fetching number rows starting middle file recreating part original file efficient 

blockquote sample reading file blockquote blockquote start fetching number rows starting middle file recreating part original file blockquote ul li length file li li open files li li skip offset sample checked source efficient syscall reading bytes li li finally wrap stream count lines measure average length li ul hr stepping back bit couple points problem blockquote validate large delimited file checking number rows file matches approximately number appended trailer blockquote ol li clear approximate match guess depends failure modes detect li li wouldnt expect average record input files make sense validate row count trailer file size expected average record count li li sampling wont pick problems small percentage records bad badness empty lines records fields empty li ol question good idea separate quick validation file big detect problem fetch send wouldnt full validation processing wouldnt make files smaller files size wouldnt pick compact representation csvs 