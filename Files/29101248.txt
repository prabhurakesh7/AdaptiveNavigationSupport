mongodb gridfs md5 hash mismatch 
vetting mongodbs gridfs binary store tests encountered rare occasion exception thrown driver case validate file stored stored properly validation driver compares computed md5 contents stored md5 back mongodbs filemd5 command exception documented work handle properly strong question happen binary mismatch happen strong understand occurred system failure happen seemingly randomly albeit 

finally time properly heres discovered default mongo driver sets whats unacknowledged write concern writes mongodb means writing mongodb asynchronous process driver hey store stuff chance mongo stores eventually response returned application immediately proceeds thread mongos gridfsfile object driver method called called stored file method md5 calculated memory driver stream divided chunks mongodb compares results mongos filemd5 command mongo issued filemd5 request takes provided id computes md5 based contents binary array chunks exist references provided id represent single entity stored gridfs causing frequent mismatches drivers computed md5 md5 returned mongo basically default write concern returning control application executing command immediately afterward mongo processes current state contents case mongodb computing md5 id written memory returned bad md5 consistent debugging details exception occurred added logging query file stored read contents point correct contents correct md5 solution mongo driver interactions gridfs write concern acknowledged means data written persisted memory mongo returning application set manually tests enable gridfs collections app start exposed configuration option spring data worthy mongo driver default write concern acknowledged theoretically remove extra bootstrapping locally machine memory processing power mongo requires store contents fast time called md5 returned correct build agents running lots concurrent tests significantly heavier load potentially limited resources mongodb didnt finish storing contents filemd5 command executed validation fixed previously tests fail build due issue run full sets tests build agents actual code correct 