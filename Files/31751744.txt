spring jpa hibernate fiscal sequence generation 
app modelling invoice country italy invoice unique sequential number holes year restart thought long hard implement found good guide custom synchronized method id problem approach developer save service id approach hidden developer thought method sounds good entity manager inside class simple optimal place finally thought hibernate interceptor give hints problem generic problem good practice follow 

problem broken requirements ol li strong sequentially unique strong generate numbers sequence starting incrementing fixed li li strong gaps strong gaps numbers number generated increment numbers generated latest number li li strong concurrency strong multiple processes generate numbers time li li strong generation creation strong numbers generated time creation record li li strong exclusive locks strong exclusive locks required generating numbers li ol solution comply requirements guarantee process locks process generate number generated guarantee make process thread generates number time continue logic impossible guarantee requirements time solution depends sacrifice sacrifice run batch process idle hours generate numbers put list front business user finance guy comply purely technical issue bothered case strategy ul li perform computation required generate invoice upfront keeping invoice number generation step step ensure exceptions occur happen number generated make lock short amount time affecting concurrency performance application li li separate table track generated number li li saving invoice exclusive row level lock sequence table isolation level find required sequence save invoice immediately time reading row incrementing saving record short operation make short transaction nested transaction main li li decent database timeout concurrent threads waiting lock time fast li li operation retry loop retrying times giving completely ensure lock queue builds fast operations times giving totally commercial packages retry count high li ul addition allowed database design guidelines put unique constraint invoice number column duplicate values stored cost spring tools implement ul li strong transactions strong href http docs spring io spring docs current spring framework reference html transaction html rel nofollow annotation li li strong serialization strong attribute annotation li li strong database access strong href http docs spring io spring docs current spring framework reference html jdbc html rel nofollow spring jdbc href http docs spring io spring docs current spring framework reference html orm html rel nofollow spring orm href http docs spring io spring data jpa docs current reference html rel nofollow spring data jpa li li strong retries strong href https github spring projects spring retry rel nofollow spring retry li ul href https github manish spring data transaction rel nofollow sample app demonstrates pieces 