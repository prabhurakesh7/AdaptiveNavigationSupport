kafka delayed queue implementation high level consumer 
implement delayed consumer high level consumer api main idea ul li produce messages key msg creation timestamp makes partition ordered messages produced time li li auto commit enable false explicitly commit message process li li consume message li li check message timestamp check time passed li li process message operation fail li li commit offset li ul concerns implementation ol li commit offset slow zk li li consumer commitoffsets throw exception consume message solve idempotent messages li li problem waiting long time committing offset delay period hours iterator sleep hours process commit zk session timeout li li zk session alive commit offsets setting hive zookeeper session timeout ms resolve dead consumer recognising li li problems missing li ol 

topic push messages delayed delayed messages processed time delay fairly straight forward regular messages processed delay put topic nice thing message head delayed topic processed delayto smallest set consumer reads head message checks timestamp past processes message commits offset commit offset sleeps time case diffrent delay times partition topic delay hours hours hours delay time dynamic bit complex solve introducing delay topics read messages delay topic process messages past find closest put topic sleep closest processed reverse process messages topic put shouldnt proccessed back topic answer specific questions addressed comments question blockquote ol li commit offset slow zk li ol blockquote switching storing offset kafka feature check property consumer config blockquote ol start li consumer commitoffsets throw exception consume message solve idempotent messages li ol blockquote communicate offset storage instance idempotent messages solves problem thou blockquote ol start li problem waiting long time committing offset delay period hours iterator sleep hours process commit zk session timeout li ol blockquote wont problem outlined solution processing message takes session timeout blockquote ol start li zk session alive commit offsets setting hive zookeeper session timeout ms resolve dead consumer recognising li ol blockquote shouldnt set long session timeout blockquote ol start li problems missing li ol blockquote 