parallel stream lambda static initializer deadlock 
strange situation parallel stream lambda static initializer takes seemingly forever cpu utilization heres code appears minimum reproducing test case behavior ul li put block main method static initializer li li remove parallelization li li remove lambda li ul code instantly completes explain behavior bug intended openjdk version internal 

found bug report similar case href https bugs openjdk net browse jdk jdk closed issue stuart marks blockquote class initialization deadlock test programs main thread executes class static initializer sets initialization progress flag class flag remains set static initializer completes static initializer executes parallel stream lambda expressions evaluated threads threads block waiting class complete initialization main thread blocked waiting parallel tasks complete resulting deadlock test program changed move parallel stream logic class static initializer closing issue blockquote hr find bug report href https bugs openjdk net browse jdk jdk closed issue stuart marks blockquote deadlock occurring fruit enums static initializer interacting badly class initialization language specification section details class initialization href http docs oracle javase specs jls se8 html jls html jls http docs oracle javase specs jls se8 html jls html jls briefly whats happening ol li main thread references fruit class starts initialization process sets initialization progress flag runs static initializer main thread li li static initializer runs code thread waits finish parallel streams streams se executing code thread means waiting code finish effect li li code thread references fruit class checks initialization progress flag thread block flag cleared step jls li li main thread blocked waiting thread terminate static initializer completes initialization progress flag isnt cleared static initializer completes threads deadlocked li ol avoid problem make classs static initialization completes quickly causing threads execute code requires class completed initialization closing issue blockquote hr href https github findbugsproject findbugs issues findbugs open issue adding warning situation 