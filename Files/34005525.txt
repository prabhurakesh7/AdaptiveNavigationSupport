mock blocking method call spock 
h1 background h1 learning href https code google spock rel nofollow spock unit testing issue head blockquote strong strong simplified idea id achieve blockquote class call accepts constructor parameter method spawns thread heavily reduced brevity normal operation call em blocks em connection made h1 problem h1 id test interactions returned spock glance works fine strong strong call return mocked call intentionally invoked indefinite number times accept indefinite number inbound connections interactions mock occur indefinite number times depending fast machine long takes run h3 cardinality h3 cardinality interaction em em interaction rubs wrong em em interaction em em interaction h3 returning h3 return mocked socket null tons calls pass parameter check ignore report ignore miss reporting legitimate issue dont return class isnt final implements version em em report test logs polluted log message reporting strong expected strong outcome strong unexpected strong h3 closures side effects h3 admittedly groovy programmer trade time worked spock apologies em plain wrong em thing misunderstanding spock mocking loops forever method called didnt closure evaluated accept method called time em em understanding method called time returned calls invoke closure loops infinitely block locally appears work build run ci service specifically travis ci test output indicating method retuning bit confusing isnt deal breaker live noisy test logs id h3 edit h3 blocking attempting verify id verify em em behavior feature method technique provided david test behaviors single method behaviors change depending number accepted connections exception encountered told stop accepting connections make single feature method complicated difficult troubleshoot document return defined number mocks method make method block verify behaviors individually deterministically feature method 

unit test test class dependencies classes code pasted verify things ol li class repeatedly calls dosomethingwithsocket provided socket li li stops io exception thrown li ol lets dosomething passed delegate class dosomethingdelegate verify lines conditions sample code provided tested delegate code class conditions mock sockets required test test behavior sockets socket hold main thread make sleep add complex behavior making method calls interact 