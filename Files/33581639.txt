returning local reference created jni native method 
jni reference blockquote local references valid duration native method call freed automatically native method returns blockquote source href http docs oracle javase docs technotes guides jni spec functions html global local rel nofollow http docs oracle javase docs technotes guides jni spec functions html global local kind lost explicitly call strong newglobalref strong pass object returned call strong newobject strong gc kicks collect references holds project strong main strong strong dummy strong libdummy implementation em native em methods behaviour main loop exhibits strange call em getweakglobalref em em getlocalref em clear em arraylist em gc collect em dummy em objects created call getglobalref objects collected clear em arraylist em kind confused return local references native methods back code 

jvm native code keeping references objects object deleted code access causing segfault objects global references garbage collected native code objects local references garbage collected function references created returned objects weak global references garbage collected native code issameobject check object weak reference garbage collected behave correctly object garbage collected blockquote means ref pinning native code jvm track local reference point assign instance variable blockquote local references tracked return assigning variable doesnt remove reference independently prevent garbage collection object returned reference stack preventing garbage collection assigned variable returned object global reference native code access object return local reference jvm garbage collect object jni function executing garbage collector runs thread doesnt explicitly call em ref delete em ref blockquote objects passed native method including returned results jni function calls automatically added registry local reference blockquote quoted href https docs oracle javase docs technotes guides jni spec design html implementing local references rel nofollow https docs oracle javase docs technotes guides jni spec design html implementing local references cases native function spawns thread continues object control returned original thread native function stores copy reference global variable subsequent calls explicitly delete references function running conserve memory function 