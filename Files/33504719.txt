write mongo aggregation query spring 
aggregation query mongodb works run directly shell heres shell query ol li matches documents ids li li projects nested field base level field effectively filters fields pipeline retaining ids li li unwinds array elements versions field projected individual documents pipeline li li finds max versions id li ol query works question translate spring mongodb syntax heres attempt strong strong work run code debug mode illegalargumentexception newaggregation evaluate comment line group clause tostring representation aggregation variable reveals problem project clause doesnt match intending syntax correct tbh dont find spring mongoops syntax intuitive documentation isnt great dont call method including call main problem doubling nesting spring mongoops heroes write equivalent code properly strong edit strong heres snapshot collection href http stack imgur svp7a png rel nofollow img src http stack imgur svp7a png alt robomongo display 

strong href https docs mongodb org manual reference operator aggregation project pipe project rel nofollow strong pipeline strong href https docs mongodb org manual reference operator aggregation unwind pipe unwind rel nofollow strong nested field aggregation pipeline yield results current spring data mongodb aggregation equivalent back current aggregation strong href https docs mongodb org manual reference operator aggregation unwind pipe unwind rel nofollow strong array field string array sprind data mongodb equivalent 