authentication token passed controlleradvice null running mockmvc 
spring boot spring spring security running integration tests mockmvc tests simulating user login works fine methods annotated calling method test principle currentuser object null class annotated controlleradvice adds logged user model accessed view works fine running application problem running tests authentication parameter passed getcurrentuser method null means references currentuser attribute view templates errors tests fail round retrieving principle change main code tests work 

setting work spring security reason spring securitys attempts resolve default retrieving attribute named attribute defined constant found set overrides previously set h1 manually solving issue h1 fix involves amount change set key ensure set attribute named leverage constant define attribute h1 spring security test h1 spring security officially added href http docs spring io spring security site docs reference htmlsingle test rel nofollow test support easiest flexible test application spring security h2 add spring security test h2 spring boot easiest ensure dependency include spring security test maven pom spring boot manages version version naturally gradle inclusion similar h2 setting mockmvc h2 order href http docs spring io spring security site docs reference htmlsingle test mockmvc rel nofollow integrate mockmvc steps perform outlined reference step ensure surprise standard step testing spring applications href http docs spring io spring security site docs reference htmlsingle test mockmvc setup rel nofollow step ensure build instance h2 running user h2 easily run specific user ways accomplishing mockmvc h3 requestpostprocessor h3 option href http docs spring io spring security site docs reference htmlsingle test mockmvc securitycontextholder rpp rel nofollow requestpostprocessor h3 annotations h3 annotations user custom user object currentuser href http docs spring io spring security site docs reference htmlsingle test method withuserdetails rel nofollow withuserdetails href http docs spring io spring security site docs reference htmlsingle test method withsecuritycontext rel nofollow withsecuritycontext href http docs spring io spring security site docs reference htmlsingle test method withuserdetails rel nofollow withuserdetails makes sense expose bean alright user looked exist alternative href http docs spring io spring security site docs reference htmlsingle test method withsecuritycontext rel nofollow withsecuritycontext makes sense require user exist withuserdetails wont elaborate documented details object model provide concrete 