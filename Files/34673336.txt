httpclient connection reset peer socket write error 
httpclient send post request created simpile wrapper httpclient easy package u8 server sdk import sun net httpserver headers import u8 server log log import org apache http header import org apache http httpentity import org apache http httpresponse import org apache http namevaluepair import org apache http client clientprotocolexception import org apache http client httpclient import org apache http client httprequestretryhandler import org apache http client responsehandler import org apache http client config requestconfig import org apache http client entity urlencodedformentity import org apache http client methods httpget import org apache http client methods httppost import org apache http config registry import org apache http config registrybuilder import org apache http conn socket connectionsocketfactory import org apache http conn socket plainconnectionsocketfactory import org apache http conn ssl noophostnameverifier import org apache http conn ssl sslconnectionsocketfactory import org apache http conn ssl truststrategy import org apache http entity bytearrayentity import org apache http impl client basiccookiestore import org apache http impl client closeablehttpclient import org apache http impl client httpclientbuilder import org apache http impl client httpclients import org apache http impl conn poolinghttpclientconnectionmanager import org apache http impl cookie basicclientcookie import org apache http message basicheader import org apache http message basicnamevaluepair import org apache http protocol httpcontext import org apache http ssl sslcontextbuilder import org apache http util entityutils import org springframework util stringutils import javax net ssl hostnameverifier import javax net ssl sslcontext import io ioexception import io unsupportedencodingexception import net cookiepolicy import net urlencoder import nio charset charset import security cert certificateexception import security cert x509certificate import util arraylist import util iterator import util list import util map created ant public class uhttpagent private int connecttimeout 5s private int sockettimeout 5s private int maxtotalconnections private static uhttpagent instance private closeablehttpclient httpclient private uhttpagent public static uhttpagent getinstance instance null instance uhttpagent return instance public static uhttpagent newinstance return uhttpagent public string string url map params return url null params utf public string post string url map params return post url null params utf public string string url map headers map params string encoding httpclient null init string fullurl url string urlparams parsegetparams params encoding urlparams null url fullurl url urlparams fullurl url urlparams log full url fullurl httpget getreq httpget fullurl trim getreq setheaders parseheaders headers responsehandler responsehandler responsehandler override public string handleresponse httpresponse httpresponse throws ioexception httpentity entity httpresponse getentity return entity null entityutils tostring entity null string res httpclient execute getreq responsehandler return res catch exception printstacktrace finally getreq releaseconnection return null public string post string url map headers map params string encoding list pairs arraylist params null string key params keyset pairs add basicnamevaluepair key params key return post url headers urlencodedformentity pairs charset forname encoding public string post string url map headers httpentity entity httpclient null init httppost httppost httppost url httppost setheaders parseheaders headers httppost setentity entity responsehandler responsehandler responsehandler override public string handleresponse httpresponse httpresponse throws ioexception httpentity entity httpresponse getentity return entity null entityutils tostring entity null string body httpclient execute httppost responsehandler return body catch ioexception printstacktrace finally httppost releaseconnection return null private header parseheaders map headers null headers headers isempty return getdefaultheaders header hs basicheader headers size int string key headers keyset hs basicheader key headers key return hs private header getdefaultheaders header hs basicheader hs basicheader content type application www form urlencoded hs basicheader user agent mozilla windows nt wow64 applewebkit khtml gecko chrome safari return hs private string parsegetparams map data string encoding data null data size keyitor data keyset iterator keyitor hasnext string key keyitor string val data key result append key append append urlencoder encode val encoding replace 2b append catch unsupportedencodingexception printstacktrace return result deletecharat result length tostring private void init requestconfig requestconfig requestconfig custom setconnecttimeout connecttimeout setsockettimeout sockettimeout setexpectcontinueenabled true setauthenticationenabled true build httprequestretryhandler retryhandler httprequestretryhandler override public boolean retryrequest ioexception int retrynum httpcontext httpcontext retrynum return false instanceof org apache http nohttpresponseexception instanceof org apache http client clientprotocolexception instanceof net socketexception return true return false sslcontext sslcontext sslcontextbuilder loadtrustmaterial null truststrategy override public boolean istrusted x509certificate chain string authtype throws certificateexception return true build hostnameverifier hostnameverifier noophostnameverifier instance sslconnectionsocketfactory sslfactory sslconnectionsocketfactory sslcontext hostnameverifier registry socketfactoryregistry registrybuilder create register http plainconnectionsocketfactory getsocketfactory register https sslfactory build poolinghttpclientconnectionmanager connmgr poolinghttpclientconnectionmanager socketfactoryregistry connmgr setmaxtotal maxtotalconnections connmgr setdefaultmaxperroute connmgr getmaxtotal httpclientbuilder builder httpclients custom setdefaultrequestconfig requestconfig setsslcontext sslcontext setconnectionmanager connmgr setretryhandler retryhandler httpclient builder build catch exception printstacktrace public httpclient gethttpclient return httpclient public void destroy httpclient null httpclient close httpclient null catch exception printstacktrace class send post request strange happened time send post request server minutes send request server minutes send request wrong net socketexception connection reset peer socket write error net socketoutputstream socketwrite0 native method net socketoutputstream socketwrite socketoutputstream net socketoutputstream write socketoutputstream org apache http impl conn loggingoutputstream write loggingoutputstream org apache http impl io sessionoutputbufferimpl streamwrite sessionoutputbufferimpl org apache http impl io sessionoutputbufferimpl flushbuffer sessionoutputbufferimpl org apache http impl io sessionoutputbufferimpl flush sessionoutputbufferimpl org apache http impl bhttpconnectionbase doflush bhttpconnectionbase org apache http impl defaultbhttpclientconnection flush defaultbhttpclientconnection org apache http impl conn cpoolproxy flush cpoolproxy org apache http protocol httprequestexecutor dosendrequest httprequestexecutor org apache http protocol httprequestexecutor execute httprequestexecutor org apache http impl execchain mainclientexec execute mainclientexec org apache http impl execchain protocolexec execute protocolexec org apache http impl execchain retryexec execute retryexec org apache http impl execchain redirectexec execute redirectexec org apache http impl client internalhttpclient doexecute internalhttpclient org apache http impl client closeablehttpclient execute closeablehttpclient org apache http impl client closeablehttpclient execute closeablehttpclient org apache http impl client closeablehttpclient execute closeablehttpclient org apache http impl client closeablehttpclient execute closeablehttpclient u8 server sdk uhttpagent post uhttpagent u8 server sdk uhttpagent post uhttpagent u8 server sdk baidu baidusdk verify baidusdk u8 server web useraction getlogintoken useraction sun reflect nativemethodaccessorimpl invoke0 native method sun reflect nativemethodaccessorimpl invoke nativemethodaccessorimpl sun reflect delegatingmethodaccessorimpl invoke delegatingmethodaccessorimpl lang reflect method invoke method send request server time steps thing happened lot 

peer client server connection reset peer means server reset socket reset means forceably closed bug server wrote server servlet case custom protocol examine behaviour server examine log files server provide clues server protection bisbehaving malicious clients server reset socket classified client misbehaving implemented client protocol code bug protocol implementation party code handling communication protocol misusing sending excessively large requests uncommon http servers protect denial service attacks imposing maximum lengths header fields bodies require clients send data fast rate pausing long periods client fallen foul protections 