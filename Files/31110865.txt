checking state reentrantreadwritelock locked read write threads waiting 
implementing support concurrent access heres roughly works ul li documents loaded demand li li document indexed document id li li document stops moved indexed document id lru cache means point cache discarded li li document accessed reading writing usual readers writers policy implemented href https docs oracle javase docs api util concurrent locks reentrantreadwritelock html rel nofollow active li li attempts lock documents locking thread invoke fails lock document thrown thread deal scope question showing message document locked open read copy li ul heres code bit simplified comments code points method marked invoke methods javadoc meant monitoring synchronization alternative methods question check locked reading writing threads queuing lock admittedly relevant current scenario check basically document question em active em em idle em move state locked reading writing threads waiting id avoid lock access information methods mentioned scenario methods reflect actual state lock action modify state lock carried inside block state lock change invoke potentially unsafe methods agree information externally lock btw sees synchronization problem code deadlock heads 

implement locks manually system lock expects unlocking performed em thread em locked dont blocking lock implementation locks locks implementation neednt worry sync strong update strong complex things documents locks condition variables differentiate em locking em grants read write access em usage counting em prevents document unloaded usage counter monitoring method determine lock type unlock deduct property strong design strong ol li store inside object li li replace field definition reference count class rename field li ol true factory object prohibits throw exception open document opened writable vice versa side thread document pass em reference em auxiliary function function check document writable implementation dont reentrant locking calls treated request em em document reference lock downgrading implemented simple method 