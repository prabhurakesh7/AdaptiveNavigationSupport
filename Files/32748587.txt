multiple group mongodb aggregation 
query executing query mongo shell perfect output strong output strong code exception code query em exception em blockquote http status request processing failed nested exception mongodb commandfailureexception serverused errmsg exception invalid operator addtoset code blockquote figure solve error 

approach define complete aggregation pipeline separate invoking method rules structure indentation present json samples find lot easier deviate structure pre class lang prettyprint override simplified naming href http docs mongodb org manual reference operator aggregation push rel nofollow strong strong href http docs mongodb org manual reference operator aggregation addtoset rel nofollow strong strong generally determined unique values including stage fact remove inherent order results earlier stage deliberately ordered token shorten single perform distinct operation pre class lang prettyprint override recommend removing essentially pass results alter documents present adding processing generally handled client generally speaking aggregation pipeline stages significant happening software layer handling database server 