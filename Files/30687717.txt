stream unpredictable performance drop reason 
streams iterate list sublists outer list size varies test runs list size benchmark runs show unexpected performance deviations strong run strong strong run strong questions ol li consistent significant performance difference loop loop test runs li li run1 stream run2 stream significant inconsistent performance deviation li ol jit makes suboptimal optimization decisions causing huge performance drop test machine 128gb ram cpu cores added benchmark stream tests loop stream pureloop make streams lambdas require lot micro optimisation efforts guarantee consistent performance strong run pure loops strong strong solution strong recommended apangin disabling href http docs oracle javase docs technotes guides vm performance enhancements html tiered compilation made jit results stable 

effect caused href https wiki openjdk net display hotspot methoddata type profile pollution explain simplified benchmark parameter slightly affect main benchmark loop results expose surprising 5x performance degradation lets run jmh option hottest code regions fast case iterations slow case iterations slow case spends time method inlined study assembly code method find longest operation hotspot compiler works jit starts method executed interpreter time collect href https wiki openjdk net display hotspot methoddata profile data methods called classes branches tiered compilation profile collected c1 compiled code profile generate c2 optimizied code application execution pattern middle generated code optimal modified behavior lets debug jvm compare execution profiles initialization loop ran long statistics appeared execution profile virtual methods implementations checkcast entries fast case profile polluted sites monomorphic jit easily inline optimize true original benchmark longer stream operations method polluted profile play profile tiered compilation options results ol li li li li li li ol finally problem unique multiple jvm bugs related performance regressions due profile pollution href https bugs openjdk net browse jdk jdk href https bugs openjdk net browse jdk jdk href https bugs openjdk net browse jdk jdk hope improved 